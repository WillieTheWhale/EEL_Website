<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>EEL - Experimental Engineering Lab</title>
    
    <!-- Preconnect to external domains for faster connection -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">

    <!-- Preload critical font with display swap for faster text rendering -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400&display=swap"></noscript>
    
    <!-- Critical CSS inlined to prevent render blocking -->
    <style>
        /* Critical above-the-fold styles only */
        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        body { 
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #FAFBFC 0%, #EEF2F5 50%, #E2E8ED 100%);
            overflow: hidden;
            height: 100vh;
            position: relative;
        }
        /* Dark mode critical styles */
        body[data-theme="dark"] {
            background: linear-gradient(180deg, #0C0E12 0%, #12161C 50%, #181D25 100%);
        }
        /* CRITICAL FIX: Hide elements before JS positions them - prevents FOUC */
        .js-positioned {
            visibility: hidden !important;
            opacity: 0 !important;
        }
    </style>
    
    <!-- Early theme detection to prevent flash of incorrect theme -->
    <script>
        (function() {
            document.documentElement.classList.add('no-transitions');
            
            var hasVisited = localStorage.getItem('eel-has-visited');
            var savedTheme = localStorage.getItem('eel-theme');
            var userHasSetTheme = localStorage.getItem('eel-theme-manually-set') === 'true';
            var theme = 'light';
            
            if (!hasVisited) {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    theme = 'dark';
                }
            } else if (userHasSetTheme && savedTheme) {
                theme = savedTheme;
            } else {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    theme = 'dark';
                } else if (savedTheme) {
                    theme = savedTheme;
                }
            }
            
            document.documentElement.setAttribute('data-theme', theme);
            if (document.body) {
                document.body.setAttribute('data-theme', theme);
                document.body.classList.add('no-transitions');
            }
            
            var meta = document.createElement('meta');
            meta.name = 'theme-color';
            meta.content = theme === 'dark' ? '#0C0E12' : '#FAFBFC';
            document.head.appendChild(meta);
            
            window.addEventListener('load', function() {
                setTimeout(function() {
                    document.documentElement.classList.remove('no-transitions');
                    if (document.body) {
                        document.body.classList.remove('no-transitions');
                    }
                }, 100);
            });
        })();
    </script>
    
    <!-- Load main stylesheet asynchronously -->
    <link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="styles.css"></noscript>
    
    <!-- Inline script for critical CSS loading -->
    <script>
        !function(e){"use strict";var t=function(t,n,r,o){var i=e.document,a=i.createElement("link");if(n)var d=n;else{var l=(i.body||i.getElementsByTagName("head")[0]).childNodes;d=l[l.length-1]}var s=i.styleSheets;if(o)for(var u in o)o.hasOwnProperty(u)&&a.setAttribute(u,o[u]);a.rel="stylesheet",a.href=t,a.media="only x",function e(t){if(i.body)return t();setTimeout(function(){e(t)})}(function(){d.parentNode.insertBefore(a,n?d:d.nextSibling)});var f=function(e){for(var t=a.href,n=s.length;n--;)if(s[n].href===t)return e();setTimeout(function(){f(e)})};function c(){a.addEventListener&&a.removeEventListener("load",c),a.media=r||"all"}return a.addEventListener&&a.addEventListener("load",c),a.onloadcssdefined=f,f(c),a};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this);
    </script>
</head>
<body>
    <!-- Expanded Container Overlay -->
    <div class="expanded-overlay" id="expandedOverlay">
        <div class="expanded-container" id="expandedContainer">
            <div class="expanded-glass-container">
                <div class="expanded-glass-layer expanded-glass-base"></div>
                <div class="expanded-glass-layer panel-glass-gloss"></div>
                <div class="expanded-glass-layer panel-glass-reflection"></div>
                <div class="expanded-glass-layer panel-glass-refraction"></div>
                <div class="expanded-glass-layer panel-glass-caustics"></div>
                <div class="expanded-glass-layer panel-glass-bands"></div>
                <button class="close-btn" id="closeBtn" onclick="collapsePanel()">&times;</button>
                <div class="expanded-content" id="expandedContent">
                    <!-- Content will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Chrome Grid Floor -->
    <div class="chrome-grid"></div>
    
    <!-- Organic Nebula Background -->
    <div class="organic-nebula">
        <div class="nebula-blob blob-primary"></div>
        <div class="nebula-blob blob-secondary"></div>
        <div class="nebula-blob blob-tertiary"></div>
        <div class="nebula-blob blob-accent-1"></div>
        <div class="nebula-blob blob-accent-2"></div>
    </div>
    
    <!-- Three.js Canvas -->
    <canvas id="three-canvas"></canvas>
    
    <!-- Chrome Cursor -->
    <div class="chrome-cursor" id="chromeCursor">
        <div class="cursor-core"></div>
        <div class="cursor-ring"></div>
    </div>
    
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
        <span class="theme-toggle-label">Toggle dark mode</span>
        <div class="theme-toggle-container">
            <div class="theme-toggle-icon">
                <div class="sun-icon">
                    <div class="sun-rays">
                        <div class="sun-ray-1"></div>
                        <div class="sun-ray-2"></div>
                        <div class="sun-ray-3"></div>
                    </div>
                </div>
                <div class="moon-icon"></div>
                <div class="moon-stars">
                    <span class="star star-1"></span>
                    <span class="star star-2"></span>
                    <span class="star star-3"></span>
                    <span class="star star-4"></span>
                </div>
            </div>
        </div>
    </button>
    
    <!-- Engineering Node Network -->
    <div class="engineering-network" id="engineeringNetwork"></div>
    
    <!-- Cyberspace Container -->
    <div class="cyberspace" id="cyberspace">
        
        <!-- Chrome Title -->
        <h1 class="chrome-title fade-element js-positioned" id="siteTitle">EEL</h1>
        <p class="subtitle fade-element js-positioned" id="siteSubtitle">Experimental Engineering Lab</p>
        
        <!-- Central Medallion -->
        <div class="central-medallion fade-element js-positioned" id="centralMedallion">
            <div class="medallion-glass-container">
                <div class="medallion-glass-layer medallion-glass-base"></div>
                <div class="medallion-glass-layer panel-glass-gloss"></div>
                <div class="medallion-glass-layer panel-glass-reflection"></div>
                <div class="medallion-glass-layer panel-glass-caustics"></div>
                <div class="medallion-glow"></div>
                <div class="medallion-content">
                    <div class="medallion-logo">
                        <img src="EEL_Logo.svg" alt="EEL - Experimental Engineering Lab" class="eel-logo-img" width="120" height="120" decoding="async">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Physics Tethers Container -->
        <div class="tethers-container" id="tethersContainer">
            <svg class="tethers-svg" id="tethersSvg">
                <defs>
                    <linearGradient id="tetherGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:transparent" />
                        <stop offset="15%" style="stop-color:var(--accent-cyan)" />
                        <stop offset="85%" style="stop-color:var(--accent-cyan)" />
                        <stop offset="100%" style="stop-color:transparent" />
                    </linearGradient>
                    <filter id="tetherGlow">
                        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <line class="tether" id="tether-projects" filter="url(#tetherGlow)"/>
                <line class="tether" id="tether-people" filter="url(#tetherGlow)"/>
                <line class="tether" id="tether-about" filter="url(#tetherGlow)"/>
                <line class="tether" id="tether-join" filter="url(#tetherGlow)"/>
            </svg>
        </div>
        
        <!-- Navigation Panels - Radial Layout -->
        <div class="nav-panel fade-element js-positioned" id="panel-projects" data-angle="315" data-content-type="projects">
            <div class="panel-glass-container">
                <div class="panel-glass-layer panel-glass-base"></div>
                <div class="panel-glass-layer panel-glass-gloss"></div>
                <div class="panel-glass-layer panel-glass-reflection"></div>
                <div class="panel-glass-layer panel-glass-refraction"></div>
                <div class="panel-glass-layer panel-glass-caustics"></div>
                <div class="panel-glass-layer panel-glass-bands"></div>
                <div class="panel-hologram"></div>
                <div class="panel-content">
                    <div class="panel-icon panel-icon-projects"></div>
                    <h2 class="panel-title">Projects</h2>
                    <p class="panel-description">
                        Explore our cutting-edge research initiatives and experimental engineering projects.
                    </p>
                    <div class="panel-data">
                        <span>ACTIVE</span>
                        <span>RESEARCH</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav-panel fade-element js-positioned" id="panel-people" data-angle="45" data-content-type="people">
            <div class="panel-glass-container">
                <div class="panel-glass-layer panel-glass-base"></div>
                <div class="panel-glass-layer panel-glass-gloss"></div>
                <div class="panel-glass-layer panel-glass-reflection"></div>
                <div class="panel-glass-layer panel-glass-refraction"></div>
                <div class="panel-glass-layer panel-glass-caustics"></div>
                <div class="panel-glass-layer panel-glass-bands"></div>
                <div class="panel-hologram"></div>
                <div class="panel-content">
                    <div class="panel-icon panel-icon-people"></div>
                    <h2 class="panel-title">People</h2>
                    <p class="panel-description">
                        Meet our team of researchers, faculty, and students driving innovation.
                    </p>
                    <div class="panel-data">
                        <span>TEAM</span>
                        <span>MEMBERS</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav-panel fade-element js-positioned" id="panel-about" data-angle="135" data-content-type="about">
            <div class="panel-glass-container">
                <div class="panel-glass-layer panel-glass-base"></div>
                <div class="panel-glass-layer panel-glass-gloss"></div>
                <div class="panel-glass-layer panel-glass-reflection"></div>
                <div class="panel-glass-layer panel-glass-refraction"></div>
                <div class="panel-glass-layer panel-glass-caustics"></div>
                <div class="panel-glass-layer panel-glass-bands"></div>
                <div class="panel-hologram"></div>
                <div class="panel-content">
                    <div class="panel-icon panel-icon-about"></div>
                    <h2 class="panel-title">About</h2>
                    <p class="panel-description">
                        Learn about our mission, facilities, and the future of experimental engineering.
                    </p>
                    <div class="panel-data">
                        <span>ABOUT</span>
                        <span>THE LAB</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav-panel fade-element js-positioned" id="panel-join" data-angle="225" data-content-type="join">
            <div class="panel-glass-container">
                <div class="panel-glass-layer panel-glass-base"></div>
                <div class="panel-glass-layer panel-glass-gloss"></div>
                <div class="panel-glass-layer panel-glass-reflection"></div>
                <div class="panel-glass-layer panel-glass-refraction"></div>
                <div class="panel-glass-layer panel-glass-caustics"></div>
                <div class="panel-glass-layer panel-glass-bands"></div>
                <div class="panel-hologram"></div>
                <div class="panel-content">
                    <div class="panel-icon panel-icon-join"></div>
                    <h2 class="panel-title">Join Us</h2>
                    <p class="panel-description">
                        Discover opportunities to contribute to groundbreaking research.
                    </p>
                    <div class="panel-data">
                        <span>APPLY</span>
                        <span>NOW</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Load Three.js with defer for non-blocking -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Load main script with defer -->
    <script defer src="script.js"></script>
    <!-- Load mobile handler script -->
    <script defer src="mobile.js"></script>
    
    <!-- Fallback for JavaScript disabled -->
    <noscript>
        <style>
            .js-positioned {
                visibility: visible !important;
                opacity: 1 !important;
            }
        </style>
    </noscript>
</body>
</html>